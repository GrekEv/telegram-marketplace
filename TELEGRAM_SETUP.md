# Настройка Telegram Mini App

## Шаг 1: Создание бота

1. Откройте [@BotFather](https://t.me/BotFather) в Telegram
2. Отправьте команду `/newbot`
3. Следуйте инструкциям:
   - Укажите имя бота (например: "Marketplace Bot")
   - Укажите username бота (например: `marketplace_bot`)
4. Сохраните токен бота

## Шаг 2: Настройка Mini App

1. Отправьте команду `/newapp` боту [@BotFather](https://t.me/BotFather)
2. Выберите созданного бота
3. Укажите название Mini App (например: "Marketplace")
4. Укажите краткое описание
5. Загрузите фото (опционально): отправьте изображение 640x360px
6. Укажите URL вашего приложения

   Для локальной разработки:
   - Используйте [ngrok](https://ngrok.com/): `ngrok http 5173`
   - Скопируйте полученный HTTPS URL
   - Пример: `https://abc123.ngrok.io`

   Для продакшна:
   - Используйте домен вашего хостинга
   - Пример: `https://marketplace.example.com`

## Шаг 3: Настройка backend

1. Откройте файл `backend/.env`
2. Добавьте/обновите переменные:
   ```env
   TELEGRAM_BOT_TOKEN=ваш_токен_от_BotFather
   TELEGRAM_BOT_USERNAME=ваш_username_бота
   ```
3. Перезапустите backend сервер

## Шаг 4: Проверка работы

### Локальная разработка с ngrok:

1. Запустите frontend:
   ```bash
   cd frontend
   npm run dev
   ```

2. В другом терминале запустите ngrok:
   ```bash
   ngrok http 5173
   ```

3. Скопируйте HTTPS URL (например: `https://abc123.ngrok.io`)

4. Обновите Mini App в BotFather с этим URL

5. Откройте бота в Telegram и нажмите на кнопку Mini App

### Продакшн:

1. Соберите frontend:
   ```bash
   cd frontend
   npm run build
   ```

2. Загрузите файлы из папки `dist/` на ваш хостинг

3. Укажите URL в BotFather

## Шаг 5: Тестирование

1. Откройте вашего бота в Telegram
2. Нажмите на кнопку Mini App
3. Приложение должно открыться
4. Проверьте:
   - Авторизация через Telegram работает
   - Можно просматривать товары
   - Можно создавать заказы

## Полезные команды BotFather

- `/mybots` - список ваших ботов
- `/myapps` - список Mini Apps
- `/deletebot` - удалить бота
- `/setmenu` - настроить меню бота

## Настройка меню бота (опционально)

Отправьте `/setmenubutton` в BotFather:
1. Выберите бота
2. Укажите текст кнопки (например: "Открыть Marketplace")
3. Укажите URL вашего Mini App

## Безопасность

ВАЖНО:
- Никогда не публикуйте токен бота в открытом доступе
- Используйте HTTPS для Mini App
- Валидация initData настроена в backend
- Данные пользователя проверяются на сервере

## Проверка валидности данных

Backend автоматически проверяет:
- Подлинность данных через HMAC-SHA256
- Актуальность данных (не старше 24 часов)
- Соответствие токена бота

## Troubleshooting

Приложение не открывается:
- Проверьте, что URL правильный и доступен
- Убедитесь, что используется HTTPS
- Проверьте CORS настройки backend

Ошибка авторизации:
- Проверьте токен бота в `.env`
- Убедитесь, что backend запущен
- Проверьте логи backend

Тема не применяется:
- Telegram автоматически передает тему
- Приложение адаптируется под тему пользователя

## Дополнительные функции

Приложение использует Telegram WebApp API:
- Вибрация (haptic feedback)
- Главная кнопка (Main Button)
- Кнопка "Назад" (Back Button)
- Закрытие приложения
- Открытие ссылок
- Отправка данных в бота

Все функции реализованы в `frontend/src/utils/telegram.js`
